<!-- Expandable left-side menu partial -->

<style>
#expandableMenu {
  position: fixed;
  top: 56px;
  left: 0;
  height: calc(100vh - 56px);
  width: 48px; /* Always visible slim sidebar */
  background: #1d351d;
  color: #fff;
  overflow-x: hidden;
  transition: width 0.3s ease;
  z-index: 1200;
  box-shadow: 2px 0 8px rgba(0,0,0,0.12);
}
#expandableMenu.open {
  width: 260px;
}
#expandableMenu .menu-header {
  padding: 18px 24px;
  font-size: 1.3em;
  background: #184218;
  border-bottom: 1px solid #2c4c2c;
}
#expandableMenu .menu-content {
  padding: 18px 24px;
}
#expandableMenu .menu-item {
  padding: 12px 0;
  cursor: pointer;
  border-bottom: 1px solid #2c4c2c;
  font-size: 1.1em;
}
#expandableMenu .menu-item:hover {
  background: #236423;
}
#expandableMenu .close-btn {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 1.5em;
  color: #fff;
  background: none;
  border: none;
  cursor: pointer;
}
#expandMenuBtn {
  position: absolute;
  top: 8px;
  left: 8px;
  transform: none;
  background: #184218;
  color: #fff;
  border: 1.5px solid #2c4c2c;
  border-radius: 6px;
  padding: 2px 10px;
  font-size: 1.6em;
  cursor: pointer;
  z-index: 2;
}
.sidebar-icons {
  margin-top: 64px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
</style>


<!-- Expandable menu -->
<div id="expandableMenu">
  <div class="menu-header" style="padding: 8px 0; position: relative;">
    <!-- Expand/collapse button absolutely positioned at top -->
    <button id="expandMenuBtn" title="Expand menu">
      <span id="expandIcon">&gt;</span>
    </button>
    <button id="expandWideBtn" title="Expand to wide menu" style="position: absolute; top: 8px; left: 48px; display: none; background: #184218; color: #fff; border: 1.5px solid #2c4c2c; border-radius: 6px; padding: 2px 10px; font-size: 1.2em; cursor: pointer; z-index: 2;">
      <span id="expandWideIcon">&#x21F2;</span>
    </button>
    <div class="sidebar-icons">
      <i class="fas fa-home" style="font-size: 1.4em;"></i>
      <i class="fas fa-cog" style="font-size: 1.4em;"></i>
      <i class="fas fa-user" style="font-size: 1.4em;"></i>
    </div>
    </div>
    <div class="menu-content" style="display: none;">
    <div id="emailMenuContainer"></div>
    </div>
</div>

<script>



const menu = document.getElementById('expandableMenu');
const btn = document.getElementById('expandMenuBtn');
const icon = document.getElementById('expandIcon');
const menuContent = menu.querySelector('.menu-content');
const wideBtn = document.getElementById('expandWideBtn');
const wideIcon = document.getElementById('expandWideIcon');
const emailMenuContainer = document.getElementById('emailMenuContainer');

function loadEmailMenu() {
  // Load Quill assets if not present
  if (!window.Quill) {
    if (!document.getElementById('quillScript')) {
      const quillScript = document.createElement('script');
      quillScript.id = 'quillScript';
      quillScript.src = 'https://cdn.quilljs.com/1.3.6/quill.js';
      document.body.appendChild(quillScript);
    }
    if (!document.getElementById('quillCss')) {
      const quillCss = document.createElement('link');
      quillCss.id = 'quillCss';
      quillCss.rel = 'stylesheet';
      quillCss.href = 'https://cdn.quilljs.com/1.3.6/quill.snow.css';
      document.head.appendChild(quillCss);
    }
  }
  // Load emailMenu.js if not present
  if (!window.renderEmailMenu) {
    if (!document.getElementById('emailMenuScript')) {
      const script = document.createElement('script');
      script.id = 'emailMenuScript';
      script.src = '/js/emailMenu.js';
      script.type = 'module';
      script.onload = () => {
        window.renderEmailMenu && window.renderEmailMenu('emailMenuContainer');
      };
      document.body.appendChild(script);
    }
  } else {
    window.renderEmailMenu('emailMenuContainer');
  }
}

btn.addEventListener('click', function() {
  if (menu.classList.contains('open')) {
    menu.classList.remove('open');
    menuContent.style.display = 'none';
    icon.innerHTML = '&gt;';
    btn.title = 'Expand menu';
    wideBtn.style.display = 'none';
    menu.style.width = '';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
    emailMenuContainer.innerHTML = '';
  } else {
    menu.classList.add('open');
    menuContent.style.display = 'block';
    icon.innerHTML = '&lt;';
    btn.title = 'Collapse menu';
    wideBtn.style.display = 'inline-block';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
    loadEmailMenu();
  }
});

wideBtn.addEventListener('click', function() {
  if (menu.style.width !== '65vw') {
    menu.style.width = '65vw';
    wideBtn.title = 'Contract to normal menu';
    wideIcon.innerHTML = '\u21F1';
  } else {
    menu.style.width = '';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
  }
});

wideBtn.addEventListener('click', function() {
  if (menu.style.width !== '65vw') {
    menu.style.width = '65vw';
    wideBtn.title = 'Contract to normal menu';
    wideIcon.innerHTML = '\u21F1';
  } else {
    menu.style.width = '';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
  }
});
</script>
