<!-- Modern Expandable Sidebar Menu (Responsive, Clean CSS) -->
<style>
#expandableMenu {
  position: fixed;
  top: 56px;
  left: 0;
  height: calc(100vh - 56px);
  width: 48px;
  background: #1d351d;
  color: #fff;
  overflow-x: hidden;
  transition: width 0.3s ease;
  z-index: 1200;
  box-shadow: 2px 0 8px rgba(0,0,0,0.12);
}
#expandableMenu.open {
  width: 260px;
}
#expandableMenu.super-expanded {
  width: 80vw;
}
@media (max-width: 600px) {
  #expandableMenu.open {
    width: 80vw;
  }
  #expandableMenu.super-expanded {
    width: 100vw;
  }
  .menu-label {
    font-size: 1em;
  }
}
@media (min-width: 1200px) {
  #expandableMenu.open {
    width: 320px;
  }
  .menu-label {
    font-size: 1.3em;
  }
}
#expandableMenu:not(.open) .menu-label {
  display: none;
}
#expandableMenu.open .menu-label {
  display: inline;
}
#expandableMenu.super-expanded .sidebar-icons {
  display: none !important;
}
#expandableMenu .menu-fixed {
  position: absolute;
  top: 0;
  left: 0;
  width: 48px;
  height: 100%;
  background: #184218;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  z-index: 1300;
  box-shadow: 2px 0 8px rgba(0,0,0,0.12);
}

#expandableMenu.super-expanded .menu-label {
  display: inline;
  font-size: 1.2em;
  font-weight: 500;
}
#expandableMenu.super-expanded .sidebar-icons i,
#expandableMenu.super-expanded .sidebar-icons .menu-label {
  font-size: 1.6em;
}
.sidebar-icons {
  margin-top: 64px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
#expandMenuBtn {
  position: absolute;
  top: 8px;
  left: 8px;
  background: #184218;
  color: #fff;
  border: 1.5px solid #2c4c2c;
  border-radius: 6px;
  padding: 2px 10px;
  font-size: 1.6em;
  cursor: pointer;
  z-index: 2;
}
#expandWideBtn {
  position: absolute;
  top: 8px;
  left: 48px;
  background: #184218;
  color: #fff;
  border: 1.5px solid #2c4c2c;
  border-radius: 6px;
  padding: 2px 10px;
  font-size: 1.2em;
  cursor: pointer;
  z-index: 2;
  display: none;
}
</style>


  <div class="menu-fixed">
    <a href="/" class="nav-link report-icon" title="Home">
      <i class="fas fa-home"></i>
      <span class="menu-label">Home</span>
    </a>
    <!-- Add more always-visible links/icons here if needed -->
  </div>

<div id="expandableMenu">
  <div class="menu-header" style="padding: 8px 0; position: relative;">
    <button id="expandMenuBtn" title="Expand menu">
      <span id="expandIcon">&gt;</span>
    </button>
    <button id="expandWideBtn" title="Expand to wide menu">
      <span id="expandWideIcon">&#x21F2;</span>
    </button>
    <div class="sidebar-icons">

      <a href="/2/customers" class="nav-link report-icon" title="List view">
        <i class="fas fa-list"></i>
        <span class="menu-label">List view</span>
      </a>
      <a href="/management-report" class="nav-link report-icon" title="Management Report">
        <i class="fas fa-chart-bar"></i>
        <span class="menu-label">Management Report</span>
      </a>

      <% if (locals.user && locals.user.roles && locals.user.roles.includes('sysadmin')) { %>
        <div class="accordion" id="adminAccordion" style="width:100%;"></div>
          <div class="accordion-item">
        <h2 class="accordion-header" id="headingAdmin">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdmin" aria-expanded="false" aria-controls="collapseAdmin">
            üõ†Ô∏è Administration
          </button>
        </h2>
        <div id="collapseAdmin" class="accordion-collapse collapse" aria-labelledby="headingAdmin" data-bs-parent="#adminAccordion">
          <div class="accordion-body" style="padding-left:0;">
            <a href="/admin/wf-rule-report-server" class="nav-link report-icon" title="WF Rule Report">
          <i class="fas fa-file-alt"></i>
          <span class="menu-label">WF Rule Report</span>
            </a>
            <a href="/admin/job-templates" class="nav-link report-icon" title="Job Templates">
          <i class="fas fa-briefcase"></i>
          <span class="menu-label">Job Templates</span>
            </a>
            <a href="/admin/customers/import" class="nav-link report-icon" title="Customer Import">
          <i class="fas fa-user-plus"></i>
          <span class="menu-label">Customer Import</span>
            </a>
            <a href="/admin/users" class="nav-link report-icon" title="Manage Users">
          <i class="fas fa-users-cog"></i>
          <span class="menu-label">Manage Users</span>
            </a>
            <a href="/admin/rule-builder" class="nav-link report-icon" title="Rule Builder">
          <i class="fas fa-cogs"></i>
          <span class="menu-label">Rule Builder</span>
            </a>
            <a href="/admin/demo/rules" class="nav-link report-icon" title="Rule Engine Demo">
          <span style="font-size:1.4em;">üß™</span>
          <span class="menu-label">Rule Engine Demo</span>
            </a>
            <a href="/admin/home" class="nav-link report-icon" title="Admin">
          <i class="fas fa-user-shield"></i>
          <span class="menu-label">Admin</span>
            </a>
          </div>
        </div>
          </div>
        </div>
      <% } %>
      
    </div>
  </div>
  <div class="menu-content" style="display: none;">
    <div class="accordion" id="emailAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingEmails">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmails" aria-expanded="false" aria-controls="collapseEmails">
            Emails
          </button>
        </h2>
        <div id="collapseEmails" class="accordion-collapse collapse" aria-labelledby="headingEmails" data-bs-parent="#emailAccordion">
          <div class="accordion-body">
            <div id="emailMenuContainer"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
const menu = document.getElementById('expandableMenu');
const btn = document.getElementById('expandMenuBtn');
const icon = document.getElementById('expandIcon');
const menuContent = menu.querySelector('.menu-content');
const wideBtn = document.getElementById('expandWideBtn');
const wideIcon = document.getElementById('expandWideIcon');
const emailMenuContainer = document.getElementById('emailMenuContainer');

function loadEmailMenu() {
  if (!window.Quill) {
    if (!document.getElementById('quillScript')) {
      const quillScript = document.createElement('script');
      quillScript.id = 'quillScript';
      quillScript.src = 'https://cdn.quilljs.com/1.3.6/quill.js';
      document.body.appendChild(quillScript);
    }
    if (!document.getElementById('quillCss')) {
      const quillCss = document.createElement('link');
      quillCss.id = 'quillCss';
      quillCss.rel = 'stylesheet';
      quillCss.href = 'https://cdn.quilljs.com/1.3.6/quill.snow.css';
      document.head.appendChild(quillCss);
    }
  }
  if (!window.renderEmailMenu) {
    if (!document.getElementById('emailMenuScript')) {
      const script = document.createElement('script');
      script.id = 'emailMenuScript';
      script.src = '/js/emailMenu.js';
      script.type = 'module';
      script.onload = () => {
        window.renderEmailMenu && window.renderEmailMenu('emailMenuContainer');
      };
      document.body.appendChild(script);
    }
  } else {
    window.renderEmailMenu('emailMenuContainer');
  }
}

btn.addEventListener('click', function() {
  if (menu.classList.contains('open')) {
    menu.classList.remove('open');
    menu.classList.remove('super-expanded');
    menuContent.style.display = 'none';
    icon.innerHTML = '&gt;';
    btn.title = 'Expand menu';
    wideBtn.style.display = 'none';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
    emailMenuContainer.innerHTML = '';
  } else {
    menu.classList.add('open');
    menuContent.style.display = 'block';
    icon.innerHTML = '&lt;';
    btn.title = 'Collapse menu';
    wideBtn.style.display = 'inline-block';
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
    loadEmailMenu();
  }
});

wideBtn.addEventListener('click', function() {
  if (!menu.classList.contains('super-expanded')) {
    menu.classList.add('super-expanded');
    wideBtn.title = 'Contract to normal menu';
    wideIcon.innerHTML = '\u21F1';
  } else {
    menu.classList.remove('super-expanded');
    wideBtn.title = 'Expand to wide menu';
    wideIcon.innerHTML = '\u21F2';
  }
});
</script>
